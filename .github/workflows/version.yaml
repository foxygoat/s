name: bump version
on:
  push:
    branches:
      - master
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@master
      with:
        fetch-depth: '0'
    - name: Bump version and push tag
      id: bump_version
      uses: anothrNick/github-tag-action@1.23.0
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        WITH_V: true
        DEFAULT_BUMP: patch
    # Get the latest module version so pkg.go.dev updates
    - uses: actions/setup-go@v2.1.1
      with:
        go-version: 1.14
    - name: Update pkg.go.dev
      env:
        GO111MODULE: on
      working-directory: /tmp
      run: go get foxygo.at/s@${{ steps.bump_version.outputs.tag }}
